<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OTP Verification</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f8f9fa;
      }
      .otp-container {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 360px;
      }
      .otp-input {
        width: 200px;
        height: 50px;
        text-align: center;
        font-size: 1.5rem;
        margin: 5px;
        border-radius: 5px;
        border: 1px solid #ced4da;
      }
      .expired {
        color: #dc3545;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="otp-container">
      <h1 class="mb-3" style="font-family: fantasy">Timeluxe</h1>
      <h5>Verification Code</h5>
      <p class="text-muted">We have sent the verification code to your email</p>
      <form id="otpForm" action="/otpverification" method="POST" onsubmit="return validateOtpForm()">
        <div class="d-flex justify-content-center mb-3">
          <input
            type="text"
            id="otp"
            name="otp"
            class="otp-input"
            maxlength="6"
            inputmode="numeric"
            pattern="[0-9]*"
            required
          />
        </div>
        <button type="submit" class="btn btn-danger w-100">Verify</button>
      </form>
      <p class="otp-timer mt-3 text-muted">
        Resend OTP in: <strong id="timerValue">02:00</strong>
      </p>
      <a
        href="#"
        id="resend-btn"
        class="text-danger"
        onclick="resendOTP(); return false;"
        >Resend</a
      >
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.all.min.js"></script>
    <script>
     let timerDuration = 120;
let timerInterval;

function startOtpTimer() {
  const timerDisplay = document.getElementById("timerValue");

  const timer = setInterval(() => {
    let minutes = Math.floor(timerDuration / 60);
    let seconds = timerDuration % 60;

    if (seconds < 10) seconds = "0" + seconds;
    if (minutes < 10) minutes = "0" + minutes;

    timerDisplay.textContent = `${minutes}:${seconds}`;

    timerDuration--;

    if (timerDuration < 0) {
      clearInterval(timer);
      timerDisplay.textContent = "00:00";
      enableResendButton(); // optional
    }
  }, 1000);
}

function enableResendButton() {
  const resendBtn = document.getElementById("resendOtpBtn");
  if (resendBtn) {
    resendBtn.disabled = false;
    resendBtn.classList.remove("disabled");
  }
}
window.onload = startOtpTimer;

function validateOtpForm(){
  const otpInput =document.getElementById("otp").value;
  $.ajax({
    type:"POST",
    url:"otpverification",
    data:{otp:otpInput},
    success:function(response){
      if(response.success){
        swal.fire({
          icon:"success",
          title:"otp verify successfully",
          showConfirmButon:false,
          timer:1500
        }).then(()=>{
          window.location.href = response.redirectUrl;
        })
      }else{
        swal.fire({
          icon:"Error",
          title:"Error",
          text:response.message
        })
      }
    },
    error:function(){
      swal.fire({
        icon:'Error',
        title:"Invalid otp",
        text:"please try again"
      })
    }
  })
  return false;
}

function resendOTP(){
  clearInterval(timerInterval)
  timerDuration = 120;
  document.getElementById("otp").disabled = false
  document.getElementById("timerValue").classList.remove("expired")
  startOtpTimer()
  $.ajax({
    type:"POST",
    url:"/resendOtp",
    success:function(response){
      if(response.success){
        swal.fire({
          icon:"success",
          title:"otp resend successfully",
          showConfirmButon:false,
          timer:1500
        })
      }else{
        swal.fire({
          icon:"error",
          title:"Error",
          text:"An error occured while resending OTP. please try again."
        })
      }
    }
  })
  return false;
}


    </script>
  </body>
</html>
